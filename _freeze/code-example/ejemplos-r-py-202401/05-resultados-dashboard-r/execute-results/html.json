{
  "hash": "7ae3c748f7c35a9a218adf3116797d14",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Resultados Dashboard con R\"\nsubtitle: \"Créditos agropecuarios y evaluaciones agropecuarias en café\"\nauthor: \"Edimer David Jaramillo\"\nformat: \n    html:\n        toc: true\n        number-sections: true\n        df-print: paged\nexecute: \n  warning: false\n  eval: false\n---\n\n\n\n# Importando bibliotecas\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(dplyr)\nlibrary(ggplot2)\n```\n:::\n\n\n\n# Importando datos\n\n- [Créditos agropecuarios](https://upra.gov.co/es-co/Paginas/eva_2023.aspx)\n- [Evaluaciones agropecuarias](https://www.datos.gov.co/Agricultura-y-Desarrollo-Rural/Colocaciones-de-Cr-dito-Sector-Agropecuario-2021-2/w3uf-w9ey/about_data)\n\n::: {.panel-tabset}\n\n## Créditos agropecuarios\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Datos de créditos agropecuarios en café\ncreditos_cafe <- read_csv(\"datos/créditos_café_colombia.csv\")\ncreditos_cafe |> head()\n```\n:::\n\n\n\n## Evaluaciones agropecuarias\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Datos de evaluaciones agropecuarias\neva_cafe <- read_csv(\"datos/evas_café.csv\")\neva_cafe |> head()\n```\n:::\n\n\n\n:::\n\n# Municipios en ambas tablas\n\n- Primero identificamos a partir de cuáles variables podríamos unir las dos bases de datos.\n- ¿Unimos los créditos a las EVAs o las EVAs a los créditos? En este caso nos interesan municipios que estén en ambas bases de datos. \n  - ¿Cuántos municipios hay en la base de datos de créditos?\n  - ¿Cuántos municipios hay en la base de datos de EVAs?\n  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Total de municipios direrentes\nmpios_unicos_creditos <-unique(creditos_cafe$id_munic)\nmpios_unicos_evas <- unique(eva_cafe$codigo_dane_municipio)\n\nlength(mpios_unicos_creditos)\nlength(mpios_unicos_evas)\n```\n:::\n\n\n- ¿Cuántos municipios comparten las dos bases de datos?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(unique(creditos_cafe$id_munic) %in% unique(eva_cafe$codigo_dane_municipio))\n```\n:::\n\n\n\n# Resumen por municipio\n\n- Para simplificar el ejercicio vamos a calcular algunas métricas estadísticas por municipio.\n\n::: {.panel-tabset}\n\n## Resumen créditos\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresumen_creditos <-\n  creditos_cafe |>\n  group_by(id_depto,\n           departamento_inversion,\n           id_munic,\n           municipio_inversion) |>\n  reframe(\n    promedio_plazo = mean(plazo, na.rm = TRUE),\n    promedio_valor = mean(vlr_inic_garantia, na.rm = TRUE)\n  )\n\nresumen_creditos |> \n  head()\n```\n:::\n\n\n\n## Resumen EVAs\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresumen_evas <-\n  eva_cafe |>\n  group_by(codigo_dane_departamento,\n           departamento,\n           codigo_dane_municipio,\n           municipio) |>\n  reframe(\n    promedio_rto = mean(rendimiento_t_ha, na.rm = TRUE),\n    promedio_pdn = mean(produccion_t, na.rm = TRUE)\n  )\n\nresumen_evas |> \n  head()\n```\n:::\n\n\n\n:::\n\n# Unión de datos\n\n- Ahora unimos los dos resúmenes. La unión se realiza teniendo en cuenta la variable municipio, pero es importante tener en cuenta que tienen diferente nombre en cada tabla.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(resumen_creditos)\nnames(resumen_evas)\n```\n:::\n\n\n\n- **Opcional:** para facilitar el proceso podemos hacer dos cosas antes de unir las bases de datos:\n  - Editar los nombres de la variable que es común en ambas tablas y a través de la cual realizamos la unión.\n  - Como el nombre del municipio y departamento está en ambas tablas, solo es necesario que lo mantengamos en una tabla, ya que se repetirá.\n  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Editando nombres y seleccionando columnas en evas\nresumen_evas2 <-\n  resumen_evas |>\n  select(id_munic = codigo_dane_municipio, promedio_rto, promedio_pdn)\n\nresumen_evas2 |> head()\n```\n:::\n\n\n  \n- Ahora unimos las dos tablas.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa <-\n  inner_join(resumen_creditos, resumen_evas2, by = \"id_munic\")\n\ndf_completa |> head()\n```\n:::\n\n\n\n- ¿Cuál es la dimensión de esta nueva base de datos?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> dim()\n```\n:::\n\n\n\n\n# Visualizaciones\n\n::: {.panel-tabset}\n\n## Distribución de variables\n\n- **Plazo del crédito:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  ggplot(aes(x = promedio_plazo)) +\n  geom_histogram(color = \"black\") +\n  labs(x = \"Plazo (meses)\",\n       y = \"Frecuencia\",\n       title = \"Distribución del plazo en créditos agropecuarios\",\n       subtitle = \"Colombia\") +\n  theme_minimal()\n```\n:::\n\n\n\n- **Valor del crédito:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  ggplot(aes(x = promedio_valor)) +\n  geom_histogram(color = \"black\") +\n  labs(x = \"Valor ($)\",\n       y = \"Frecuencia\",\n       title = \"Distribución del valor en créditos agropecuarios\",\n       subtitle = \"Colombia\") +\n  theme_minimal()\n```\n:::\n\n\n\n- **Promedio de rendimiento:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  ggplot(aes(x = promedio_rto)) +\n  geom_histogram(color = \"black\") +\n  labs(x = \"Rendimiento (t/ha)\",\n       y = \"Frecuencia\",\n       title = \"Distribución del rendimiento promedio en café\",\n       subtitle = \"Colombia\") +\n  theme_minimal()\n```\n:::\n\n\n\n- **Producción en toneladas del cultivo de café:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  ggplot(aes(x = promedio_pdn)) +\n  geom_histogram(color = \"black\") +\n  labs(x = \"Producción (t)\",\n       y = \"Frecuencia\",\n       title = \"Distribución de producción promedio en café\",\n       subtitle = \"Colombia\") +\n  theme_minimal()\n```\n:::\n\n\n\n## Monto vs Rendimiento\n\n- ¿En qué departamentos se solicita mayor monto de créditos?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  ggplot(aes(x = departamento_inversion, y = promedio_valor)) +\n  geom_boxplot() +\n  labs(x = \"Departamento\",\n       y = \"Valor ($)\",\n       title = \"Distribución de monto de crédito por departamento\",\n       subtitle = \"Colombia\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n:::\n\n\n\n- ¿En qué departamentos hay mayores rendimientos?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  ggplot(aes(x = departamento_inversion, y = promedio_rto)) +\n  geom_boxplot() +\n  labs(x = \"Departamento\",\n       y = \"Rendimiento (t/ha)\",\n       title = \"Distribución del rendimiento por departamento\",\n       subtitle = \"Colombia\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n:::\n\n\n\n## Monto vs rendimiento\n\n- ¿Existe asociación entre el monto del crédito y el rendimiento?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor(df_completa$promedio_valor, df_completa$promedio_rto, use = \"pairwise.complete.obs\")\n```\n:::\n\n\n\n- Graficamos el diagrama de dispersión:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  # filter(promedio_valor <= 4e+07) |>\n  ggplot(aes(x = promedio_valor, y = promedio_rto)) +\n  geom_point() +\n  labs(x = \"Valor ($)\",\n       y = \"Rendimiento (t/ha)\",\n       title = \"Monto del crédito vs rendimiento\",\n       subtitle = \"Colombia\") +\n  theme_minimal()\n```\n:::\n\n\n\n## Monto vs producción\n\n- Ahora relacionamos el valor del crédito con la producción:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor(df_completa$promedio_valor, df_completa$promedio_pdn, use = \"pairwise.complete.obs\")\n```\n:::\n\n\n\n- Gráfico:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_completa |> \n  # filter(promedio_valor <= 4e+07) |>\n  ggplot(aes(x = promedio_valor, y = promedio_pdn)) +\n  geom_point() +\n  labs(x = \"Valor ($)\",\n       y = \"Producción (t)\",\n       title = \"Monto del crédito vs producción\",\n       subtitle = \"Colombia\") +\n  theme_minimal() +\n  scale_y_log10()\n```\n:::\n\n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}